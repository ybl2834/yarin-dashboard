<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>-Dashboard 砖 专</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :root {
            --army-green: #2e7d32;
            --academic-blue: #1976d2;
            --personal-pink: #e91e63;
            --bg-color: #f0f2f5;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
        }

        .widget {
            width: 100%; max-width: 500px;
            background: white; border-radius: 15px;
            padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .dashboard-header {
            width: 100%; max-width: 500px;
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px;
        }

        .event-card {
            display: flex; background: #fafafa;
            margin-bottom: 12px; padding: 12px;
            border-radius: 10px; border-right: 6px solid #ccc;
        }

        .event-time {
            font-weight: bold; min-width: 70px;
            color: #555; border-left: 1px solid #eee;
            margin-left: 10px; display: flex; align-items: center;
        }

        .refresh-btn {
            background-color: var(--academic-blue); color: white;
            border: none; padding: 10px 20px; border-radius: 20px;
            cursor: pointer; font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="dashboard-header">
        <h2>砖 专 </h2>
        <button class="refresh-btn" onclick="handleAuthClick()"> 转专 专注 "</button>
    </div>

    <div class="widget">
        <h3> " 转 砖 ()</h3>
        <div id="calendar-events">
            <p>抓 注 "转专"  专转 转 专注 砖...</p>
        </div>
    </div>

    <script>
        const CLIENT_ID = '988499305718-7pmnra8k2hs9mht1hjj6a127astgrvk5.apps.googleusercontent.com';
        const SCOPES = 'https://www.googleapis.com/auth/calendar.readonly';
        
        let tokenClient;
        let gapiInited = false;

        // 转专转 
        function handleAuthClick() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: async (response) => {
                    if (response.error !== undefined) throw (response);
                    await listUpcomingEvents(response.access_token);
                },
            });
            tokenClient.requestAccessToken({prompt: 'consent'});
        }

        // 砖转 专注 -API
        async function listUpcomingEvents(authResult) {
            const response = await fetch('https://www.googleapis.com/calendar/v3/calendars/primary/events?timeMin=' + new Date().toISOString() + '&maxResults=5&orderBy=startTime&singleEvents=true', {
                headers: { 'Authorization': `Bearer ${authResult}` }
            });
            
            const data = await response.json();
            const events = data.items;
            const container = document.getElementById('calendar-events');
            container.innerHTML = ''; // 拽 注

            if (!events || events.length == 0) {
                container.innerHTML = ' 爪 专注 拽专.';
                return;
            }

            events.forEach(event => {
                const start = event.start.dateTime || event.start.date;
                const time = new Date(start).toLocaleTimeString('he-IL', {hour: '2-digit', minute:'2-digit'});
                
                const eventHtml = `
                    <div class="event-card">
                        <div class="event-time">${time}</div>
                        <div class="event-details">
                            <h4>${event.summary}</h4>
                        </div>
                    </div>`;
                container.innerHTML += eventHtml;
            });
        }
    </script>
</body>
</html>